<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Show enterprise</title>
    <link rel="canonical" href="https://getbootstrap.com/docs/5.3/examples/sign-in/">
    <link rel="stylesheet" href="../../static/css/bootstrap.css">
    <meta name="theme-color" content="#712cf9">
    <link rel="stylesheet" href="../../static/css/cover.css">
</head>
<body class="d-flex h-100 text-center text-bg-dark">
<div class="cover-container d-flex w-100 h-100 p-3 mx-auto flex-column">
    <header class="mb-auto">
        <div>
            <h3 class="float-md-start mb-0">Car park</h3>
            <nav class="nav nav-masthead justify-content-center float-md-end">
                <a class="nav-link fw-bold py-1 px-0 active" aria-current="page" href="#"></a>
                <a class="nav-link fw-bold py-1 px-0" href="#"></a>
                <a class="nav-link fw-bold py-1 px-0" href="#"></a>
            </nav>
        </div>
    </header>
    <main class="px-3">
        <h1 th:text="'This is your Car ' + ${vehicle.getId()} + ', ' + ${vehicle.getYearManufacture()}
 + ', brand is ' + ${vehicle.getCarBrand()}">
            Vehicle</h1>

        <h3>Table of rides</h3>
        <table class="table table-striped table-sm">
            <thead>
            <tr>
                <th scope="col">Start coordinates</th>
                <th scope="col">End coordinates</th>
                <th scope="col">Start address</th>
                <th scope="col">End address</th>
                <th scope="col">Start date</th>
                <th scope="col">End date</th>
                <th scope="col"></th>
            </tr>
            </thead>
            <tbody id="vehicle-rides">
            </tbody>
        </table>

        <br/>
        <form th:method="GET" th:action="@{/car/{id}/edit(id=${vehicle.getId()})}">
            <input type="submit" value="Edit"/>
        </form>
        <br/>
        <form th:method="DELETE" th:action="@{/car/{id}(id=${vehicle.getId()})}">
            <input type="submit" value="Delete"/>
        </form>
    </main>

    <footer class="mt-auto text-white-50">
        <p>By car park</p>
    </footer>
</div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
<script src="../../static/js/bootstrap.js"></script>
<script th:inline="javascript">
    const getRides = () => {
        let id = [[${vehicle.getId()}]];
        $.getJSON('../vehicle/' + id + '/track/all?start=2023-12-01_11:12:54&end=2023-12-31_18:13:34', function (data) {
            for (let i = 0; i < data.length; i++) {
                $('#vehicle-rides').append(
                    '<tr> <td>' + data[i].startCoordinates.longitude + ', ' + data[i].startCoordinates.latitude +
                    '</td>' +
                    '<td>' + data[i].endCoordinates.longitude + ', ' + data[i].endCoordinates.latitude +
                    '</td>' +
                    '<td>' + data[i].startAddress +
                    '</td>' +
                    '<td>' + data[i].endAddress +
                    '</td>' +
                    '<td>' + new Date(Date.parse(data[i].dtStart)) +
                    '</td>' +
                    '<td>' + new Date(Date.parse(data[i].dtEnd)) +
                    '</td>' +
                    '<td> <button onclick="showTrack(this)" class="btn btn-primary d-inline-flex align-items-center" type="button">More' +
                    '  </button>' +
                    '</td>' +
                    '</tr>'
                )
            }
        });
    }
    getRides();
    const showTrack = (e) => {
        var data = e.target || e.srcElement || e;
        let id = [[${vehicle.getId()}]];
        $.getJSON('../vehicle/' + id + '/track?start=' + data.dtStart + '&end=' + data.dtEnd, function (s) {
            $('#vehicle-list').append(
                '<p>' + s + '</p>'
            );
        });
    }
</script>
</body>
</html>